apiVersion: v1
kind: ConfigMap
metadata:
  name: trivy-operator-config
  namespace: trivy-system
  labels:
    app.kubernetes.io/name: trivy-operator
    app.kubernetes.io/part-of: security
data:
  # Scanner configuration
  scanJob.podTemplateContainerSecurityContext: |
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    privileged: false
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault

  # Vulnerability scanner settings
  vulnerabilityReports.scanner: "Trivy"

  # Config audit settings
  configAuditReports.scanner: "Trivy"

  # Scan namespaces (empty = all namespaces)
  scanJob.compressLogs: "true"

  # Severity thresholds
  severity.critical: "true"
  severity.high: "true"
  severity.medium: "true"
  severity.low: "false"
  severity.unknown: "false"

  # Resource limits for scan jobs
  scanJob.resources.requests.cpu: "100m"
  scanJob.resources.requests.memory: "100Mi"
  scanJob.resources.limits.cpu: "500m"
  scanJob.resources.limits.memory: "500Mi"

  # Trivy server mode (recommended for production)
  trivy.mode: "ClientServer"
  trivy.serverURL: "http://trivy-server.trivy-system.svc.cluster.local:4954"

  # Image pull settings
  trivy.imageRef: "ghcr.io/aquasecurity/trivy:0.50.0"

  # Database settings
  trivy.dbRepository: "ghcr.io/aquasecurity/trivy-db"
  trivy.javaDbRepository: "ghcr.io/aquasecurity/trivy-java-db"

  # Skip certain directories
  trivy.skipDirs: "/proc,/sys,/dev"

  # Ignore unfixed vulnerabilities
  trivy.ignoreUnfixed: "false"

  # Timeout for scan operations
  trivy.timeout: "10m0s"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: trivy-operator-policies-config
  namespace: trivy-system
  labels:
    app.kubernetes.io/name: trivy-operator
data:
  # Built-in policies for configuration auditing
  policy.bundle: "ghcr.io/aquasecurity/trivy-policies:0"

  # Policy namespaces to include
  policy.namespaces: "appshield,defsec"

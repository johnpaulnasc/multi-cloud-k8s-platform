apiVersion: v1
kind: ConfigMap
metadata:
  name: alertmanager-templates
  namespace: monitoring
data:
  default.tmpl: |
    {{ define "slack.default.title" }}
    [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }}
    {{ end }}

    {{ define "slack.default.text" }}
    {{ range .Alerts }}
    *Alert:* {{ .Labels.alertname }}{{ if .Labels.severity }} - `{{ .Labels.severity }}`{{ end }}
    *Cluster:* {{ .Labels.cluster }}
    *Cloud Provider:* {{ .Labels.cloud_provider }}
    *Environment:* {{ .Labels.environment }}

    *Description:* {{ .Annotations.description }}
    *Summary:* {{ .Annotations.summary }}

    *Details:*
    {{ range .Labels.SortedPairs }}  â€¢ *{{ .Name }}:* `{{ .Value }}`
    {{ end }}

    {{ if .Annotations.runbook_url }}*Runbook:* {{ .Annotations.runbook_url }}{{ end }}
    {{ if .Annotations.dashboard_url }}*Dashboard:* {{ .Annotations.dashboard_url }}{{ end }}
    {{ end }}
    {{ end }}

    {{ define "slack.default.footer" }}
    Sent by Alertmanager | {{ .ExternalURL }}
    {{ end }}

  pagerduty.tmpl: |
    {{ define "pagerduty.default.description" }}
    {{ .CommonLabels.alertname }} - {{ .CommonAnnotations.summary }}
    {{ end }}

    {{ define "pagerduty.default.client" }}
    Alertmanager
    {{ end }}

    {{ define "pagerduty.default.client_url" }}
    {{ template "__alertmanagerURL" . }}
    {{ end }}

    {{ define "pagerduty.default.instances" }}
    {{ range .Alerts }}
      - Cluster: {{ .Labels.cluster }}
      - Cloud: {{ .Labels.cloud_provider }}
      - Environment: {{ .Labels.environment }}
      - Description: {{ .Annotations.description }}
    {{ end }}
    {{ end }}
